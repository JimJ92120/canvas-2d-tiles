(()=>{"use strict";var e={56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var o={},a=[],s=0;s<e.length;s++){var c=e[s],h=i.base?c[0]+i.base:c[0],l=o[h]||0,d="".concat(h," ").concat(l);o[h]=l+1;var u=n(d),m={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==u)t[u].references++,t[u].updater(m);else{var p=r(m,i);i.byIndex=s,t.splice(s,0,{identifier:d,updater:p,references:1})}a.push(d)}return a}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var o=i(e=e||[],r=r||{});return function(e){e=e||[];for(var a=0;a<o.length;a++){var s=n(o[a]);t[s].references--}for(var c=i(e,r),h=0;h<o.length;h++){var l=n(o[h]);0===t[l].references&&(t[l].updater(),t.splice(l,1))}o=c}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},208:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(601),r=n.n(i),o=n(314),a=n.n(o)()(r());a.push([e.id,"body {\n  margin: 0;\n\n  min-height: 100vh;\n  background-color: black;\n  color: white;\n}\n\nbody > * {\n  box-sizing: border-box;\n}\n\n#app {\n  display: flex;\n  flex-flow: column;\n  margin-left: auto;\n  margin-right: auto;\n\n  position: relative;\n  max-width: 500px;\n}\n\n.scene {\n  background-color: lightblue;\n  image-rendering: pixelated;\n}\n.debug-scene {\n  display: none;\n  background-color: lightgrey;\n  border: 1px solid red;\n  image-rendering: pixelated;\n}\n\n.prompt {\n  background-color: white;\n  color: black;\n\n  display: none;\n  position: absolute;\n  bottom: 0;\n  padding: 1rem;\n  width: calc(100% - 2rem);\n  white-space: pre-wrap;\n}\n\n.prompt--active,\n.prompt--active-debug {\n  display: block;\n}\n.prompt * {\n  font-size: 1rem;\n  margin: 0;\n  padding: 0;\n}\n\n/* debug */\n.app--debug {\n  .debug-scene {\n    display: block;\n  }\n\n  .prompt--active {\n    bottom: 50%;\n  }\n}\n",""]);const s=a},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,i,r,o){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(i)for(var s=0;s<this.length;s++){var c=this[s][0];null!=c&&(a[c]=!0)}for(var h=0;h<e.length;h++){var l=[].concat(e[h]);i&&a[l[0]]||(void 0!==o&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=o),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),r&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=r):l[4]="".concat(r)),t.push(l))}},t}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var t={};e.exports=function(e,n){var i=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,r&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(i,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={id:i,exports:{}};return e[i](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var r=i.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=i[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),n.nc=void 0;var i=n(72),r=n.n(i),o=n(825),a=n.n(o),s=n(659),c=n.n(s),h=n(56),l=n.n(h),d=n(540),u=n.n(d),m=n(113),p=n.n(m),f=n(208),v={};v.styleTagTransform=p(),v.setAttributes=l(),v.insert=c().bind(null,"head"),v.domAPI=a(),v.insertStyleElement=u(),r()(f.A,v),f.A&&f.A.locals&&f.A.locals;class y{constructor(e){this.$container=e}render(){this.$container.innerHTML='\n      <canvas class="scene"></canvas>\n      <div class="prompt">Hello world</div>\n\n      <canvas class="debug-scene"></canvas>\n  '}}var g=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))};class w{constructor(e,t,n={}){this.currentContent=[],this.currentContentIndex=0,this.$container=e,this.activeClassName=t,this.animationRecord=n}get isShown(){return this.$container.classList.contains(this.activeClassName)}show(e){return g(this,void 0,void 0,(function*(){e instanceof Array?this.isShown?console.error("prompt is already shown"):(this.currentContent=e,yield this.showCurrentContent(),this.$container.classList.add(this.activeClassName)):console.error("content is not an array:",e)}))}hide(){return g(this,void 0,void 0,(function*(){this.animationRecord.onHide&&(yield this.animationRecord.onHide(this.$container,this.currentContent[this.currentContentIndex])),this.currentContentIndex=0,this.currentContent=[],this.$container.innerHTML="",this.$container.classList.remove(this.activeClassName)}))}next(){return g(this,void 0,void 0,(function*(){return this.isShown?(++this.currentContentIndex,!(this.currentContent.length<=this.currentContentIndex)&&this.showCurrentContent()):(console.error("prompt not shown"),!1)}))}showCurrentContent(){return g(this,void 0,void 0,(function*(){return this.currentContent[this.currentContentIndex]?(this.$container.innerHTML="",this.animationRecord.onShow?yield this.animationRecord.onShow(this.$container,this.currentContent[this.currentContentIndex]):this.$container.textContent=this.currentContent[this.currentContentIndex],!0):(console.error(`current content index ${this.currentContentIndex} not found`),!1)}))}}var b,x,F,S,P=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))};!function(e){e[e.Default=0]="Default",e[e.Raw=1]="Raw",e[e.All=2]="All"}(b||(b={}));class R{constructor(e,t,n){this.assetRecord={},this.$scene=e,this.context=this.$scene.getContext("2d"),this.viewOffset=t,this.options=n}get width(){return this.$scene.width}get height(){return this.$scene.height}getTileSize(e){const{scene:t}=this.options;return t.minimumFrameSize?[t.size[0]/t.minimumFrameSize[0],t.size[1]/t.minimumFrameSize[1]]:[t.size[0]/e[0],t.size[1]/e[1]]}resize(e,t){this.options.scene.minimumFrameSize=[e,t];const n=this.getTileSize([e,t]);this.$scene.width=e*n[0],this.$scene.height=t*n[1]}init(){const{minimumFrameSize:e}=this.options.scene;this.resize(e[0],e[1])}loadAssets(e){return P(this,void 0,void 0,(function*(){return yield Promise.all(Object.keys(e).map((t=>this.loadImage(t,e[t]))))}))}animateCharacter(e,t,n,i,r){return P(this,void 0,void 0,(function*(){const{animationDuration:o}=this.options,a=[r[0].length,r.length],s=this.getTileSize(a);n=[(n[0]-this.viewOffset[0])*s[0],(n[1]-this.viewOffset[1])*s[1]];let c=0,h=null;return new Promise((a=>{h=setInterval((()=>{if(i.length<=c)return clearInterval(h),void a();this.clear(),this.renderFrameWithAssets(e,r,s),this.renderCharacterWithSprite(t,n,i[c],s),++c}),o/i.length)}))}))}render(e,t,n,i,r,o,a){const{scene:s}=this.options;this.clear();const c=[a[0].length,a.length],h=this.getTileSize(c);s.minimumFrameSize&&(s.minimumFrameSize[0]<c[0]||s.minimumFrameSize[1]<c[1])?this.focus(i,c):0===this.viewOffset[0]&&0===this.viewOffset[1]||(this.viewOffset=[0,0]);const l=[(i[0]-this.viewOffset[0])*h[0],(i[1]-this.viewOffset[1])*h[1]];this.renderFrame(e,a),this.renderCharacter(t,n,l,r,o,h)}focus(e,t){const{scene:n}=this.options;if(!n.minimumFrameSize)return;const i=[0==n.minimumFrameSize[0]%2?Math.floor(n.minimumFrameSize[0]/2)-1:Math.floor(n.minimumFrameSize[0]/2),0==n.minimumFrameSize[1]%2?Math.floor(n.minimumFrameSize[1]/2)-1:Math.floor(n.minimumFrameSize[1]/2)];let r=[i[0]>=e[0]?0:e[0]-i[0],i[1]>=e[1]?0:e[1]-i[1]];t[0]<r[0]+n.minimumFrameSize[0]&&(r[0]=t[0]-n.minimumFrameSize[0]),t[1]<r[1]+n.minimumFrameSize[1]&&(r[1]=t[1]-n.minimumFrameSize[1]),this.viewOffset=r}clear(){this.context.clearRect(0,0,this.width,this.height)}renderCharacter(e,t,n,i,r,o){const{mode:a}=this.options;switch(a){case b.All:this.renderRawCharacter(e,n,i,o),this.renderCharacterWithSprite(t,n,r,o);break;case b.Default:this.renderCharacterWithSprite(t,n,r,o);break;case b.Raw:this.renderRawCharacter(e,n,i,o)}}renderFrame(e,t){const{mode:n}=this.options;this.context.clearRect(0,0,this.width,this.height);const i=[t[0].length,t.length],r=this.getTileSize(i);switch(n){case b.All:this.renderRawData(t,r),this.renderFrameWithAssets(e,t,r);break;case b.Default:this.renderFrameWithAssets(e,t,r);break;case b.Raw:this.renderRawData(t,r)}}loadImage(e,t){return P(this,void 0,void 0,(function*(){return new Promise((n=>{this.assetRecord[e]=new Image,this.assetRecord[e].src=t,this.assetRecord[e].addEventListener("load",(()=>(console.log(`${e} image loaded`),n(this.assetRecord[e]))))}))}))}renderRawCharacter(e,t,n,i){const{characters:r}=this.options;this.context.fillStyle=r[e].color,this.context.fillRect(t[0],t[1],i[0],i[1]);let o=[t[0],t[1]];switch(n){case"up":o[0]+=i[0]/2;break;case"down":o[0]+=i[0]/2,o[1]+=i[1];break;case"left":o[1]+=i[1]/2;break;case"right":o[0]+=i[0],o[1]+=i[1]/2;break;default:return}this.context.strokeStyle="black",this.context.lineWidth=5,this.context.beginPath(),this.context.moveTo(t[0]+i[0]/2,t[1]+i[1]/2),this.context.lineTo(o[0],o[1]),this.context.stroke()}renderCharacterWithSprite(e,t,n,i){const r=this.assetRecord[e];r?this.context.drawImage(r,r.width/4*n[0],r.height/4*n[1],i[0],i[1],t[0],t[1],i[0],i[1]):console.error(`character asset ${e} not found`)}renderRawData(e,t){const{tile:n,scene:i}=this.options;let r=[...e];i.minimumFrameSize&&(r=e.slice(this.viewOffset[1],this.viewOffset[1]+i.minimumFrameSize[1]).map((e=>e.slice(this.viewOffset[0],this.viewOffset[0]+i.minimumFrameSize[0])))),r.map(((e,i)=>{e.map(((e,r)=>{e&&n.colors[e]&&(this.context.fillStyle=n.colors[e],this.context.fillRect(r*t[0],i*t[1],t[0],t[1]))}))}))}renderFrameWithAssets(e,t,n){this.assetRecord[`${e}`]?this.context.drawImage(this.assetRecord[`${e}`],-this.viewOffset[0]*n[0],-this.viewOffset[1]*n[1],t[0].length*n[0],t.length*n[1]):b.Default===this.options.mode&&this.renderRawData(t,n)}}!function(e){e[e.Empty=0]="Empty",e[e.Block=1]="Block",e[e.Building=2]="Building",e[e.Action=3]="Action"}(x||(x={})),function(e){e.Prompt="prompt",e.Load="load"}(F||(F={}));class C{constructor(e,t,n,i){this.data=e,this.actionRecord=t,this.initialPlayerPosition=n,this.background=i}get width(){return this.data[0].length}get height(){return this.data.length}runAction(e,t){const n=this.getAction(e);n?t(n):console.error(`no action found at [${e}]`)}getAction(e){return this.actionRecord[e.join(":")]||null}}!function(e){e.Up="up",e.Down="down",e.Left="left",e.Right="right"}(S||(S={}));var k=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))};class ${constructor(e,t,n,i){this.frameRecord={},this.currentFrameKey="main",this.mapRenderer=null,this.mainFrameLastPosition=[0,0],this.isPlayerMoving=!1,this.player=e,this.frameRecord=t,this.renderer=new R(n.$scene,n.viewOffset,n.options),n.mapScene&&(this.mapRenderer=new R(n.mapScene.$scene,[0,0],Object.assign(Object.assign({},n.options),{mode:n.mapScene.mode,scene:{size:[...n.options.scene.size],minimumFrameSize:[0,0]}}))),this.prompt=new w(i.$prompt,i.activeClassName,i.animationRecord)}get isPromptShown(){return this.prompt.isShown}get currentFrame(){return this.frameRecord[this.currentFrameKey]}init(){return k(this,void 0,void 0,(function*(){this.loadFrame("main"),this.renderer.init(),yield this.loadAssets(this.renderer),this.mapRenderer&&(this.mapRenderer.init(),[b.Default,b.All].includes(this.mapRenderer.options.mode)&&(yield this.loadAssets(this.mapRenderer))),this.render()}))}render(){var e;const t=null!==(e=this.player.sprite.directionsOffset[this.player.direction])&&void 0!==e?e:[0,0];this.renderer.render(this.currentFrame.background.name,this.player.name,this.player.sprite.name,this.player.position,this.player.direction,t,this.currentFrame.data),this.mapRenderer&&this.mapRenderer.render(this.currentFrameKey,this.player.name,this.player.sprite.name,this.player.position,this.player.direction,t,this.currentFrame.data)}nextOrHidePrompt(){return k(this,void 0,void 0,(function*(){return!!(yield this.prompt.next())||(this.prompt.hide(),!1)}))}movePlayer(e){return k(this,void 0,void 0,(function*(){if(this.isPlayerMoving)return;yield this.prompt.hide();const t=this.getDirectionFromKey(e);if(!t)return;const n=this.getPlayerPositionFromDirection(t);if(!this.isPositionValid(n))return;const i=this.currentFrame.data[n[1]][n[0]];switch(this.player.direction=t,yield this.animatePlayer(t),i){case x.Empty:this.player.position=n;break;case x.Action:this.runFrameAction(n);case x.Block:case x.Building:}this.render()}))}loadAssets(e){return k(this,void 0,void 0,(function*(){const t=Object.assign({[this.player.sprite.name]:this.player.sprite.asset},Object.keys(this.frameRecord).reduce(((e,t)=>(""!==this.frameRecord[t].background.asset&&(e[this.frameRecord[t].background.name]=this.frameRecord[t].background.asset),e)),{}));yield e.loadAssets(t)}))}loadFrame(e){if(!this.frameRecord[e])return;const t=this.currentFrameKey;this.currentFrameKey=e,"main"!==this.currentFrameKey||"main"===this.currentFrameKey&&this.currentFrameKey===t?(this.mainFrameLastPosition=this.player.position,this.player.position=this.currentFrame.initialPlayerPosition):this.player.position=this.mainFrameLastPosition,this.mapRenderer&&this.mapRenderer.resize(this.currentFrame.width,this.currentFrame.height)}isPositionValid(e){return 0>e[0]||0>e[1]||this.currentFrame.width<=e[0]||this.currentFrame.height<=e[1]?(console.error(`nextPosition [${e}] is out of bound`),!1):this.currentFrame.data[e[1]]&&!isNaN(Number(this.currentFrame.data[e[1]][e[0]]))}getDirectionFromKey(e){let t=null;switch(e){case"up":t=S.Up;break;case"down":t=S.Down;break;case"left":t=S.Left;break;case"right":t=S.Right}return t}getPlayerPositionFromDirection(e){let t=[...this.player.position];switch(e){case S.Up:--t[1];break;case S.Down:++t[1];break;case S.Left:--t[0];break;case S.Right:++t[0]}return t}animatePlayer(e){return k(this,void 0,void 0,(function*(){const t=this.player.sprite.animationsOffsetList[e];t&&(this.isPlayerMoving=!0,yield this.renderer.animateCharacter(this.currentFrame.background.name,this.player.sprite.name,this.player.position,t,this.currentFrame.data),this.isPlayerMoving=!1)}))}runFrameAction(e){return k(this,void 0,void 0,(function*(){yield this.currentFrame.runAction(e,(e=>k(this,void 0,void 0,(function*(){switch(e.type){case F.Prompt:yield this.prompt.show(e.data);break;case F.Load:this.loadFrame(e.data)}}))))}))}}var z=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))};class A{constructor(e){this.typingInterval=0,this.$container=e}get isTyping(){return Boolean(this.typingInterval)}clear(){this.clearInterval()}type(e,t){return z(this,void 0,void 0,(function*(){return new Promise((n=>z(this,void 0,void 0,(function*(){this.isTyping&&console.error("prompt is already typing"),this.$container.innerHTML="",e instanceof HTMLElement||(yield this.typeString(e,t)),n()}))))}))}typeString(e,t){return z(this,void 0,void 0,(function*(){const n=e.split("\n");this.clearInterval();let i=0,r=0;return new Promise((e=>{this.typingInterval=setInterval((()=>{try{0===r&&0!==i&&(this.$container.textContent+="\n"),this.$container.textContent+=n[i][r],n[i].length<=r+1?(++i,r=0):++r}catch(e){this.clearInterval()}}),t),e()}))}))}clearInterval(){clearInterval(this.typingInterval),this.typingInterval=0}}const I=n.p+"assets/map.png",O=new C([[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,2,2,1,2,2,2,2,2,2,1,1,1,1,2,2,2,1,1],[1,2,3,2,1,2,2,3,3,2,2,1,1,1,1,2,3,2,1,1],[1,1,0,1,1,1,0,0,0,0,1,1,1,1,0,0,0,1,1,1],[1,1,0,1,1,1,0,0,0,0,0,0,0,1,1,1,0,1,1,1],[1,1,0,1,1,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1],[1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1],[1,1,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,1,1,1],[1,1,0,0,0,0,0,1,0,0,0,0,0,2,2,2,2,2,2,1],[1,1,1,1,1,1,1,1,0,0,0,0,0,2,3,2,2,3,2,1],[1,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,1],[1,2,2,3,3,2,2,2,3,2,0,0,0,0,0,0,0,0,0,1],[1,1,1,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,1],[1,1,1,1,0,0,0,0,0,0,0,0,0,2,2,3,3,2,2,1],[1,1,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,2,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],{"2:2":{type:F.Prompt,data:["a small building"]},"7:2":{type:F.Prompt,data:["a large building"]},"8:2":{type:F.Prompt,data:["a large building"]},"16:2":{type:F.Prompt,data:["a small building"]},"14:10":{type:F.Prompt,data:["a small building"]},"17:10":{type:F.Prompt,data:["a small building"]},"3:12":{type:F.Prompt,data:["a large building","closed"]},"4:12":{type:F.Prompt,data:["a large building","closed"]},"8:12":{type:F.Prompt,data:["a small building\nclosed"]},"15:14":{type:F.Prompt,data:["a large building"]},"16:14":{type:F.Prompt,data:["a large building"]},"3:16":{type:F.Load,data:"home"}},[3,17],{name:"main-background",asset:I}),L=new C([[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,3,1,3,1,1,1],[1,1,2,0,0,0,0,1,1,1],[1,1,3,0,0,0,0,1,1,1],[1,1,2,0,0,0,0,3,1,1],[1,1,1,0,0,0,0,3,1,1],[1,1,1,0,0,0,0,1,1,1],[1,1,1,1,3,3,1,1,1,1],[1,1,1,1,1,1,1,1,1,1]],{"2:4":{type:F.Prompt,data:["desk"]},"4:2":{type:F.Prompt,data:["guitar"]},"6:2":{type:F.Prompt,data:["tinkering"]},"7:5":{type:F.Prompt,data:["shelf"]},"7:6":{type:F.Prompt,data:["moto"]},"4:8":{type:F.Load,data:"main"},"5:8":{type:F.Load,data:"main"}},[4,7],{name:"home-background",asset:""}),T=n.p+"assets/player.png",D=new class{constructor(e,t,n,i){this.name=e,this.position=t,this.direction=n,this.sprite=i}}("player",[0,0],S.Up,{name:"player-sprite",asset:T,directionsOffset:{up:[2,0],down:[0,0],left:[1,0],right:[3,0]},animationsOffsetList:{up:[[2,1]],down:[[0,1]],left:[[1,1]],right:[[3,1]]}});var M=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((i=i.apply(e,t||[])).next())}))};const E=[10,10];document.addEventListener("DOMContentLoaded",(()=>M(void 0,void 0,void 0,(function*(){const e=function(){const{width:e,height:t}=window.screen;let n=t<=e?t:e;return 500<n&&(n=500),n}(),t=new y(document.querySelector("#app"));t.render(),t.$container.style.maxWidth=`${e}px`,t.$container.classList.add("app--debug");let n=function(e,t,n,i,r,o=!1){return{renderer:{$scene:e,viewOffset:[0,0],mapScene:o?{$scene:t,mode:b.Raw}:null,options:{mode:b.Default,scene:{size:[i,i],minimumFrameSize:r},animationDuration:150,tile:{colors:{1:"grey",2:"blue",3:"green"}},characters:{player:{color:"red"}}}},prompt:{$prompt:n,activeClassName:"prompt--active",animationRecord:{}},frameRecord:{main:O,home:L},player:D}}(t.$container.querySelector(".scene"),t.$container.querySelector(".debug-scene"),t.$container.querySelector(".prompt"),e,E,!0);const i=new A(n.prompt.$prompt);n.prompt.animationRecord={onShow:(e,t)=>new Promise((e=>M(void 0,void 0,void 0,(function*(){yield i.type(t,50),e()})))),onHide:()=>new Promise((e=>{i.clear(),e()}))};const r=new $(n.player,n.frameRecord,n.renderer,n.prompt);yield r.init(),function(e){document.addEventListener("keyup",(t=>{return n=this,i=void 0,o=function*(){switch(t.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":yield e.movePlayer(t.key.replace("Arrow","").toLowerCase());break;case"Escape":case" ":yield e.nextOrHidePrompt()}},new((r=void 0)||(r=Promise))((function(e,t){function a(e){try{c(o.next(e))}catch(e){t(e)}}function s(e){try{c(o.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(a,s)}c((o=o.apply(n,i||[])).next())}));var n,i,r,o}))}(r)}))))})();