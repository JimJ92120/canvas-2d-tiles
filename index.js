(()=>{"use strict";var e={56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var s={},a=[],o=0;o<e.length;o++){var c=e[o],d=i.base?c[0]+i.base:c[0],l=s[d]||0,u="".concat(d," ").concat(l);s[d]=l+1;var h=n(u),m={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==h)t[h].references++,t[h].updater(m);else{var p=r(m,i);i.byIndex=o,t.splice(o,0,{identifier:u,updater:p,references:1})}a.push(u)}return a}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var s=i(e=e||[],r=r||{});return function(e){e=e||[];for(var a=0;a<s.length;a++){var o=n(s[a]);t[o].references--}for(var c=i(e,r),d=0;d<s.length;d++){var l=n(s[d]);0===t[l].references&&(t[l].updater(),t.splice(l,1))}s=c}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},208:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(601),r=n.n(i),s=n(314),a=n.n(s)()(r());a.push([e.id,"body {\n  margin: 0;\n\n  min-height: 100vh;\n  background-color: black;\n  color: white;\n}\n\nbody > * {\n  box-sizing: border-box;\n}\n\n#app {\n  display: flex;\n  flex-flow: column;\n  margin-left: auto;\n  margin-right: auto;\n\n  position: relative;\n  max-width: 500px;\n}\n\n.scene {\n  background-color: lightblue;\n}\n\n.prompt {\n  background-color: white;\n  color: black;\n\n  display: none;\n  position: absolute;\n  bottom: 0;\n  padding: 1rem;\n  width: calc(100% - 2rem);\n  white-space: pre-wrap;\n}\n\n.prompt--active,\n.prompt--active-debug {\n  display: block;\n}\n.prompt * {\n  font-size: 1rem;\n  margin: 0;\n  padding: 0;\n}\n\n/* debug */\n.debug-scene {\n  display: none;\n  background-color: lightgrey;\n  border: 1px solid red;\n}\n.debug-scene--active {\n  display: block;\n}\n\n.app--debug {\n  .prompt--active {\n    bottom: 50%;\n  }\n}\n",""]);const o=a},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,i,r,s){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(i)for(var o=0;o<this.length;o++){var c=this[o][0];null!=c&&(a[c]=!0)}for(var d=0;d<e.length;d++){var l=[].concat(e[d]);i&&a[l[0]]||(void 0!==s&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=s),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),r&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=r):l[4]="".concat(r)),t.push(l))}},t}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var t={};e.exports=function(e,n){var i=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,r&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleTagTransform(i,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var s=t[i]={id:i,exports:{}};return e[i](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var r=i.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=i[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),n.nc=void 0;var i=n(72),r=n.n(i),s=n(825),a=n.n(s),o=n(659),c=n.n(o),d=n(56),l=n.n(d),u=n(540),h=n.n(u),m=n(113),p=n.n(m),f=n(208),g={};g.styleTagTransform=p(),g.setAttributes=l(),g.insert=c().bind(null,"head"),g.domAPI=a(),g.insertStyleElement=h(),r()(f.A,g),f.A&&f.A.locals&&f.A.locals;class y{constructor(e){this.$container=e}render(){this.$container.innerHTML='\n      <canvas class="scene"></canvas>\n      <div class="prompt">Hello world</div>\n\n      <canvas class="debug-scene"></canvas>\n  '}}class v{constructor(e,t){this.$container=e,this.activeClassName=t}get isShown(){return this.$container.classList.contains(this.activeClassName)}show(e){this.isShown?console.error("prompt is already shown"):(this.$container.innerHTML="",e instanceof HTMLElement?this.$container.appendChild(e):this.$container.textContent=e,this.$container.classList.add(this.activeClassName))}hide(){this.$container.innerHTML="",this.$container.classList.remove(this.activeClassName)}}var b,w,S,F=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((i=i.apply(e,t||[])).next())}))};class P{constructor(e,t,n){this.assetRecord={},this.$scene=e,this.context=this.$scene.getContext("2d"),this.viewOffset=t,this.options=n}get width(){return this.$scene.width}get height(){return this.$scene.height}getTileSize(e){const{scene:t}=this.options;return t.minimumFrameSize?[t.size[0]/t.minimumFrameSize[0],t.size[1]/t.minimumFrameSize[1]]:[t.size[0]/e[0],t.size[1]/e[1]]}resize(e,t){this.options.scene.minimumFrameSize=[e,t];const n=this.getTileSize([e,t]);this.$scene.width=e*n[0],this.$scene.height=t*n[1]}init(){const{minimumFrameSize:e}=this.options.scene;this.resize(e[0],e[1])}loadAssets(e,t){return F(this,void 0,void 0,(function*(){return yield Promise.all(Object.keys(t).map((n=>this.loadImage(`${e}-${n}`,t[n]))))}))}render(e,t,n,i){const{scene:r}=this.options;this.context.clearRect(0,0,this.width,this.height);const s=[i[0].length,i.length],a=this.getTileSize(s);r.minimumFrameSize&&(r.minimumFrameSize[0]<s[0]||r.minimumFrameSize[1]<s[1])?this.focus(t,s):0===this.viewOffset[0]&&0===this.viewOffset[1]||(this.viewOffset=[0,0]),this.renderData(e,i,a),this.renderPlayer(t,n,a)}focus(e,t){const{scene:n}=this.options;if(!n.minimumFrameSize)return;const i=[0==n.minimumFrameSize[0]%2?Math.floor(n.minimumFrameSize[0]/2)-1:Math.floor(n.minimumFrameSize[0]/2),0==n.minimumFrameSize[1]%2?Math.floor(n.minimumFrameSize[1]/2)-1:Math.floor(n.minimumFrameSize[1]/2)];let r=[i[0]>=e[0]?0:e[0]-i[0],i[1]>=e[1]?0:e[1]-i[1]];t[0]<r[0]+n.minimumFrameSize[0]&&(r[0]=t[0]-n.minimumFrameSize[0]),t[1]<r[1]+n.minimumFrameSize[1]&&(r[1]=t[1]-n.minimumFrameSize[1]),this.viewOffset=r}loadImage(e,t){return F(this,void 0,void 0,(function*(){return new Promise((n=>{this.assetRecord[e]=new Image,this.assetRecord[e].src=t,this.assetRecord[e].addEventListener("load",(()=>(console.log(`${e} image loaded`),n(this.assetRecord[e]))))}))}))}renderPlayer(e,t,n){const{player:i,debug:r}=this.options,s=[(e[0]-this.viewOffset[0])*n[0],(e[1]-this.viewOffset[1])*n[1]];if(r){this.context.fillStyle=i.color,this.context.fillRect(s[0],s[1],n[0],n[1]);let e=[s[0],s[1]];switch(t){case"up":e[0]+=n[0]/2;break;case"down":e[0]+=n[0]/2,e[1]+=n[1];break;case"left":e[1]+=n[1]/2;break;case"right":e[0]+=n[0],e[1]+=n[1]/2;break;default:return}this.context.strokeStyle="black",this.context.lineWidth=5,this.context.beginPath(),this.context.moveTo(s[0]+n[0]/2,s[1]+n[1]/2),this.context.lineTo(e[0],e[1]),this.context.stroke()}const a=this.assetRecord[`player-${t}`];a&&this.context.drawImage(a,s[0],s[1],n[0],n[1])}renderData(e,t,n){const{tile:i,scene:r,debug:s}=this.options;let a=[...t];r.minimumFrameSize&&(a=t.slice(this.viewOffset[1],this.viewOffset[1]+r.minimumFrameSize[1]).map((e=>e.slice(this.viewOffset[0],this.viewOffset[0]+r.minimumFrameSize[0])))),s&&a.map(((e,t)=>{e.map(((e,r)=>{e&&i.colors[e]&&(this.context.fillStyle=i.colors[e],this.context.fillRect(r*n[0],t*n[1],n[0],n[1]))}))})),this.assetRecord[`frame-${e}-background`]&&this.context.drawImage(this.assetRecord[`frame-${e}-background`],-this.viewOffset[0]*n[0],-this.viewOffset[1]*n[1],t[0].length*n[0],t.length*n[1])}}!function(e){e[e.Empty=0]="Empty",e[e.Block=1]="Block",e[e.Building=2]="Building",e[e.Action=3]="Action"}(b||(b={})),function(e){e.Prompt="prompt",e.Load="load"}(w||(w={}));class x{constructor(e,t,n,i){this.data=e,this.actionRecord=t,this.initialPlayerPosition=n,this.assetRecord=i}get width(){return this.data[0].length}get height(){return this.data.length}runAction(e,t){const n=this.getAction(e);n?t(n):console.error(`no action found at [${e}]`)}getAction(e){return this.actionRecord[e.join(":")]||null}}!function(e){e.Up="up",e.Down="down",e.Left="left",e.Right="right"}(S||(S={}));var R=function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function a(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((i=i.apply(e,t||[])).next())}))};class ${constructor(e,t,n,i){this.frameRecord={},this.currentFrameKey="main",this.debugRenderer=null,this.mainFrameLastPosition=[0,0],this.player=e,this.frameRecord=t,this.renderer=new P(n.$scene,n.viewOffset,n.options),n.$debugScene&&(this.debugRenderer=new P(n.$debugScene,[0,0],Object.assign(Object.assign({},n.options),{debug:!0,scene:{size:[...n.options.scene.size],minimumFrameSize:[0,0]}}))),this.prompt=new v(i.$prompt,i.activeClassName)}get currentFrame(){return this.frameRecord[this.currentFrameKey]}init(){return R(this,void 0,void 0,(function*(){this.loadFrame("main"),this.renderer.init(),yield this.loadAssets(this.renderer),this.debugRenderer&&this.debugRenderer.init(),this.render()}))}render(){this.renderer.render(this.currentFrameKey,this.player.position,this.player.direction,this.currentFrame.data),this.debugRenderer&&this.debugRenderer.render(this.currentFrameKey,this.player.position,this.player.direction,this.currentFrame.data)}hidePrompt(){this.prompt.isShown&&this.prompt.hide()}movePlayer(e){this.hidePrompt();const t=this.getDirectionFromKey(e);if(!t)return!1;const n=this.getPlayerPositionFromDirection(t);if(!this.isPositionValid(n))return!1;const i=this.currentFrame.data[n[1]][n[0]];switch(this.player.direction=t,i){case b.Empty:return this.player.position=n,!0;case b.Block:case b.Building:return!1;case b.Action:return this.runFrameAction(n),!0;default:return!1}}loadAssets(e){return R(this,void 0,void 0,(function*(){yield e.loadAssets("player",this.player.assetRecord),yield Promise.all(Object.keys(this.frameRecord).map((t=>e.loadAssets(`frame-${t}`,this.frameRecord[t].assetRecord))))}))}loadFrame(e){if(!this.frameRecord[e])return;const t=this.currentFrameKey;this.currentFrameKey=e,"main"!==this.currentFrameKey||"main"===this.currentFrameKey&&this.currentFrameKey===t?(this.mainFrameLastPosition=this.player.position,this.player.position=this.currentFrame.initialPlayerPosition):this.player.position=this.mainFrameLastPosition,this.debugRenderer&&this.debugRenderer.resize(this.currentFrame.width,this.currentFrame.height)}isPositionValid(e){return 0>e[0]||0>e[1]||this.currentFrame.width<=e[0]||this.currentFrame.height<=e[1]?(console.error(`nextPosition [${e}] is out of bound`),!1):this.currentFrame.data[e[1]]&&!isNaN(Number(this.currentFrame.data[e[1]][e[0]]))}getDirectionFromKey(e){let t=null;switch(e){case"up":t=S.Up;break;case"down":t=S.Down;break;case"left":t=S.Left;break;case"right":t=S.Right}return t}getPlayerPositionFromDirection(e){let t=[...this.player.position];switch(e){case S.Up:--t[1];break;case S.Down:++t[1];break;case S.Left:--t[0];break;case S.Right:++t[0]}return t}runFrameAction(e){this.currentFrame.runAction(e,(e=>{switch(e.type){case w.Prompt:this.prompt.show(e.data);break;case w.Load:this.loadFrame(e.data)}}))}}const z=[10,10],L={DEBUG:!0,MAX_SCENE_SIZE:500,MINIMUM_FRAME_SIZE:z,TILE_SIZE:[500/z[0],500/z[1]],TILE_COLORS:{1:"grey",2:"blue",3:"green"},PLAYER_COLOR:"red"},k=n.p+"assets/map.png",A=new x([[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,2,2,1,2,2,2,2,2,2,1,1,1,1,2,2,2,1,1],[1,2,3,2,1,2,2,3,3,2,2,1,1,1,1,2,3,2,1,1],[1,1,0,1,1,1,0,0,0,0,1,1,1,1,0,0,0,1,1,1],[1,1,0,1,1,1,0,0,0,0,0,0,0,1,1,1,0,1,1,1],[1,1,0,1,1,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1],[1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1],[1,1,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,1,1,1],[1,1,0,0,0,0,0,1,0,0,0,0,0,2,2,2,2,2,2,1],[1,1,1,1,1,1,1,1,0,0,0,0,0,2,3,2,2,3,2,1],[1,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,1],[1,2,2,3,3,2,2,2,3,2,0,0,0,0,0,0,0,0,0,1],[1,1,1,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,1],[1,1,1,1,0,0,0,0,0,0,0,0,0,2,2,3,3,2,2,1],[1,1,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,2,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],{"2:2":{type:w.Prompt,data:"a small building"},"7:2":{type:w.Prompt,data:"a large building"},"8:2":{type:w.Prompt,data:"a large building"},"16:2":{type:w.Prompt,data:"a small building"},"14:10":{type:w.Prompt,data:"a small building"},"17:10":{type:w.Prompt,data:"a small building"},"3:12":{type:w.Prompt,data:"a large building"},"4:12":{type:w.Prompt,data:"a large building"},"8:12":{type:w.Prompt,data:"a small building"},"15:14":{type:w.Prompt,data:"a large building"},"16:14":{type:w.Prompt,data:"a large building"},"3:16":{type:w.Load,data:"home"}},[3,17],{background:k}),E=new x([[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,3,1,3,1,1,1],[1,1,2,0,0,0,0,1,1,1],[1,1,3,0,0,0,0,1,1,1],[1,1,2,0,0,0,0,3,1,1],[1,1,1,0,0,0,0,3,1,1],[1,1,1,0,0,0,0,1,1,1],[1,1,1,1,3,3,1,1,1,1],[1,1,1,1,1,1,1,1,1,1]],{"2:4":{type:w.Prompt,data:"desk"},"4:2":{type:w.Prompt,data:"guitar"},"6:2":{type:w.Prompt,data:"tinkering"},"7:5":{type:w.Prompt,data:"shelf"},"7:6":{type:w.Prompt,data:"moto"},"4:8":{type:w.Load,data:"main"},"5:8":{type:w.Load,data:"main"}},[4,7],{}),O=n.p+"assets/player-up.png",C=n.p+"assets/player-down.png",M=n.p+"assets/player-left.png",T=n.p+"assets/player-right.png",I=new class{constructor(e,t,n){this.position=e,this.direction=t,this.assetRecord=n}}([0,0],S.Up,{up:O,down:C,left:M,right:T});document.addEventListener("DOMContentLoaded",(()=>{return e=void 0,t=void 0,i=function*(){const e=function(e){const{width:t,height:n}=window.screen;let i=n<=t?n:t;return e<i&&(i=e),i}(L.MAX_SCENE_SIZE),t=new y(document.querySelector("#app"));t.render(),t.$container.style.maxWidth=`${e}px`;let n={$scene:t.$container.querySelector(".scene"),$debugScene:null,viewOffset:[0,0],options:{debug:!0,scene:{size:[e,e],minimumFrameSize:L.MINIMUM_FRAME_SIZE},tile:{colors:L.TILE_COLORS},player:{color:L.PLAYER_COLOR}}},i={$prompt:t.$container.querySelector(".prompt"),activeClassName:"prompt--active"};const r={main:A,home:E};L.DEBUG&&(n.options.debug=L.DEBUG,n.$debugScene=t.$container.querySelector(".debug-scene"),n.$debugScene.classList.add("debug-scene--active"),t.$container.classList.add("app--debug"));const s=new $(I,r,n,i);yield s.init(),function(e){document.addEventListener("keyup",(t=>{switch(t.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":e.movePlayer(t.key.replace("Arrow","").toLowerCase()),e.render();break;case"Escape":case" ":e.hidePrompt()}}))}(s)},new((n=void 0)||(n=Promise))((function(r,s){function a(e){try{c(i.next(e))}catch(e){s(e)}}function o(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((i=i.apply(e,t||[])).next())}));var e,t,n,i}))})();